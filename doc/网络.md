# 传输层 #

## tcp ##

### 三次握手 ###

为什么要三次握手？
增加第三次握手的过程是为了，防止在第一次握手的过程因为网络问题，导致没有及时的被服务器收到。然后客户端再次向服务端发起连接请求，然后第一次超时的连接到达了服务端，然后会开启多个tcp连接。如果延迟到达的请求过多，会导致服务器开启段连接过多，导致服务器异常。

### 四次挥手 ###

为什么要四次挥手？
因为tcp是双工的，数据的传输是双向的。四次挥手中的前两次挥手，是客户端将客户端向服务端传输数据的过程断开，后两次挥手是服务端断开服务端对客户端的数据传输。中间的过程是服务端对客户端数据的单向传输。

第四次挥手发出之后，客户端为什么要等待两个MSL？
如果第四次挥手没有按时抵达服务端，那么服务端会在第三次挥手发出的2MSL（也就是第四次挥手发出后的1MSL）后，重新发出第三次挥手。这次重新发出的挥手，会在失败的第四次挥手发出后的2MSL到达客户端。这也就是2MSL等待时间的由来，TIME_WAIT。


### 流量控制 ###

发送方通过接受方返回的确认报文中的的窗口大小来调整发送方的滑动窗口的大小。从而影响发送速率。

### 拥塞控制 ###

1. 慢开启 从1开始两倍增加
2. 拥塞避免 当到达 ssthresh 之后，每次增加一个
3. 快恢复 当出现超时时，将传输量降低到超时时的传输量的一半
4. 快重传 当传输丢失，接收方没有收到某个报文时，接收方连续对丢失报文的进行三次确认，发送方立即重新发送该报文

## udp ##

1. udp无连接
2. 支持一对一、一对多
3. 面向报文
4. 尽力交付，不可靠


## 区别 ##

1. 连接上：tcp 在连接时会进行三次握手的过程，但是udp没有连接的过程
2. 传输上：tcp 会确保数据传输到达，但是udp不会。tcp 存在确认机制，会确认数据传输到，如果超时没有进行确认，会进行超时重传。
3. 速率上：tcp 有拥塞控制和流量控制，来控制传输的速度，udp没有类似的机制来控制传输的速度。
4. 传输单元上：tcp 是字节流，udp 是报文。